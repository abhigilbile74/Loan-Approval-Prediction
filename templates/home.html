<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Approval Prediction System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .loan-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            position: relative;
            z-index: 1;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            padding: 40px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .form-section h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.8em;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.3);
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .charts-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e1e8ed;
        }

        .chart-container h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4em;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .prediction-result {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 30px;
            display: block;
        }

        .prediction-result.approved {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .prediction-result.rejected {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .prediction-result h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .prediction-result p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .error-message {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }

        .info-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .info-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 4px solid #3498db;
        }

        .info-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .info-card p {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .probability-text {
            text-align: center;
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border-radius: 10px;
            font-weight: 600;
        }

        .probability-text p {
            margin: 0;
            font-size: 1.1em;
        }

        .probability-meter {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .probability-value {
            font-size: 2em;
            font-weight: bold;
            color: #fff;
        }

        .probability-label {
            font-size: 1.2em;
            color: rgba(255,255,255,0.9);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="loan-icon">üí∞</div>
            <h1>Loan Approval Prediction System</h1>
            <p>Get instant loan approval predictions with AI-powered analysis</p>
        </div>

        <div class="main-content">
            <div class="form-section">
                <h2>Loan Application Form</h2>
                
                {% if error %}
                <div class="error-message">
                    ‚ùå Error: {{ error }}
                </div>
                {% endif %}

                <form id="loanForm" action="{{ url_for('predict_datapoint') }}" method="post">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="gender">Gender</label>
                            <select id="gender" name="gender" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="married">Married</label>
                            <select id="married" name="married" required>
                                <option value="">Select Status</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="education">Education</label>
                            <select id="education" name="education" required>
                                <option value="">Select Education</option>
                                <option value="Graduate">Graduate</option>
                                <option value="Not Graduate">Not Graduate</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="selfEmployed">Self Employed</label>
                            <select id="selfEmployed" name="selfEmployed" required>
                                <option value="">Select Status</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="applicantIncome">Applicant Income (‚Çπ)</label>
                        <input type="number" id="applicantIncome" name="applicantIncome" required min="0" placeholder="Enter monthly income">
                    </div>

                    <div class="form-group">
                        <label for="coapplicantIncome">Co-applicant Income (‚Çπ)</label>
                        <input type="number" id="coapplicantIncome" name="coapplicantIncome" required min="0" placeholder="Enter co-applicant monthly income">
                    </div>

                    <div class="form-group">
                        <label for="loanAmount">Loan Amount (‚Çπ)</label>
                        <input type="number" id="loanAmount" name="loanAmount" required min="0" placeholder="Enter loan amount">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="loanAmountTerm">Loan Term (Months)</label>
                            <input type="number" id="loanAmountTerm" name="loanAmountTerm" required min="1" placeholder="Loan term in months">
                        </div>
                        <div class="form-group">
                            <label for="dependents">Number of Dependents</label>
                            <select id="dependents" name="dependents" required>
                                <option value="">Select Dependents</option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3+">3+</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="creditHistory">Credit History</label>
                            <select id="creditHistory" name="creditHistory" required>
                                <option value="">Select Credit History</option>
                                <option value="1">Good (1)</option>
                                <option value="0">Poor (0)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="propertyArea">Property Area</label>
                            <select id="propertyArea" name="propertyArea" required>
                                <option value="">Select Property Area</option>
                                <option value="Urban">Urban</option>
                                <option value="Semiurban">Semi-urban</option>
                                <option value="Rural">Rural</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="submit-btn">Predict Loan Approval</button>
                </form>
                
                {% if result %}
                <div class="prediction-result {{ 'approved' if result == 'Y' else 'rejected' }}">
                    <h2>THE prediction is {{ result }}</h2>
                    <p>
                        {% if result == 'Y'%}
                            üéâ Congratulations! Your loan application has been approved!
                        {% else %}
                            ‚ùå Unfortunately, your loan application has been rejected. Please review the requirements and try again.
                        {% endif %}
                    </p>
                </div>
                {% endif %}
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <h3>Loan Approval Probability</h3>
                    <div class="chart-wrapper">
                        <canvas id="probabilityChart"></canvas>
                    </div>
                    <div id="probabilityText" class="probability-text">
                        <p>Fill out the form to see your loan approval probability</p>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Income Distribution Analysis</h3>
                    <div class="chart-wrapper">
                        <canvas id="incomeChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Credit Score Impact</h3>
                    <div class="chart-wrapper">
                        <canvas id="creditChart"></canvas>
                    </div>
                </div>

                <div class="info-cards">
                    <div class="info-card">
                        <h4>üìä Approval Rate</h4>
                        <p>68% of applications get approved with good credit history</p>
                    </div>
                    <div class="info-card">
                        <h4>üí∞ Income Factor</h4>
                        <p>Higher income increases approval chances significantly</p>
                    </div>
                    <div class="info-card">
                        <h4>üè† Property Impact</h4>
                        <p>Urban properties have better approval rates</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize charts
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            setupFormListeners();
        });

        function setupFormListeners() {
            // Add event listeners to form fields for real-time probability calculation
            const formFields = ['gender', 'married', 'education', 'selfEmployed', 'applicantIncome', 
                               'coapplicantIncome', 'loanAmount', 'loanAmountTerm', 'dependents', 
                               'creditHistory', 'propertyArea'];
            
            formFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', updateProbabilityChart);
                    field.addEventListener('change', updateProbabilityChart);
                }
            });
        }

        function calculateLoanProbability() {
            const formData = {
                gender: document.getElementById('gender').value,
                married: document.getElementById('married').value,
                education: document.getElementById('education').value,
                selfEmployed: document.getElementById('selfEmployed').value,
                applicantIncome: parseFloat(document.getElementById('applicantIncome').value) || 0,
                coapplicantIncome: parseFloat(document.getElementById('coapplicantIncome').value) || 0,
                loanAmount: parseFloat(document.getElementById('loanAmount').value) || 0,
                loanAmountTerm: parseFloat(document.getElementById('loanAmountTerm').value) || 0,
                dependents: document.getElementById('dependents').value,
                creditHistory: document.getElementById('creditHistory').value,
                propertyArea: document.getElementById('propertyArea').value
            };

            // Check if all required fields are filled
            const requiredFields = ['gender', 'married', 'education', 'selfEmployed', 'dependents', 'creditHistory', 'propertyArea'];
            const isFormComplete = requiredFields.every(field => formData[field] !== '') && 
                                 formData.applicantIncome > 0 && formData.loanAmount > 0 && formData.loanAmountTerm > 0;

            if (!isFormComplete) {
                return null;
            }

            // Calculate probability based on various factors
            let probability = 50; // Base probability

            // Credit History (most important factor)
            if (formData.creditHistory === '1') {
                probability += 25;
            } else {
                probability -= 20;
            }

            // Income factors
            const totalIncome = formData.applicantIncome + formData.coapplicantIncome;
            if (totalIncome >= 50000) {
                probability += 15;
            } else if (totalIncome >= 25000) {
                probability += 8;
            } else if (totalIncome < 15000) {
                probability -= 10;
            }

            // Loan amount vs income ratio
            if (formData.loanAmount > 0 && totalIncome > 0) {
                const incomeRatio = formData.loanAmount / (totalIncome * 12);
                if (incomeRatio <= 3) {
                    probability += 12;
                } else if (incomeRatio <= 5) {
                    probability += 5;
                } else {
                    probability -= 15;
                }
            }

            // Education
            if (formData.education === 'Graduate') {
                probability += 8;
            }

            // Property area
            if (formData.propertyArea === 'Urban') {
                probability += 6;
            } else if (formData.propertyArea === 'Semiurban') {
                probability += 3;
            }

            // Employment status
            if (formData.selfEmployed === 'No') {
                probability += 5;
            }

            // Dependents
            if (formData.dependents === '0') {
                probability += 5;
            } else if (formData.dependents === '1') {
                probability += 3;
            } else if (formData.dependents === '3+') {
                probability -= 5;
            }

            // Marital status
            if (formData.married === 'Yes' && formData.coapplicantIncome > 0) {
                probability += 4;
            }

            return Math.max(0, Math.min(100, probability));
        }

        function updateProbabilityChart() {
            const probability = calculateLoanProbability();
            const probabilityText = document.getElementById('probabilityText');
            
            if (probability === null) {
                probabilityText.innerHTML = '<p>Fill out the form to see your loan approval probability</p>';
                return;
            }

            // Update probability text
            let riskLevel = '';
            let riskColor = '';
            if (probability >= 80) {
                riskLevel = 'Very High';
                riskColor = '#27ae60';
            } else if (probability >= 60) {
                riskLevel = 'High';
                riskColor = '#2ecc71';
            } else if (probability >= 40) {
                riskLevel = 'Medium';
                riskColor = '#f39c12';
            } else {
                riskLevel = 'Low';
                riskColor = '#e74c3c';
            }

            probabilityText.innerHTML = `
                <p>Your Loan Approval Probability</p>
                <div class="probability-meter">
                    <span class="probability-value" style="color: ${riskColor}">${probability}%</span>
                    <span class="probability-label">(${riskLevel} Chance)</span>
                </div>
            `;

            // Update probability chart
            updateProbabilityChartVisualization(probability);
        }

        function updateProbabilityChartVisualization(probability) {
            const ctx = document.getElementById('probabilityChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.probabilityChartInstance) {
                window.probabilityChartInstance.destroy();
            }

            window.probabilityChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Approval Chance', 'Rejection Chance'],
                    datasets: [{
                        data: [probability, 100 - probability],
                        backgroundColor: [
                            probability >= 60 ? 'rgba(46, 204, 113, 0.8)' : 
                            probability >= 40 ? 'rgba(241, 196, 15, 0.8)' : 'rgba(231, 76, 60, 0.8)',
                            'rgba(231, 76, 60, 0.3)'
                        ],
                        borderColor: [
                            probability >= 60 ? 'rgba(46, 204, 113, 1)' : 
                            probability >= 40 ? 'rgba(241, 196, 15, 1)' : 'rgba(231, 76, 60, 1)',
                            'rgba(231, 76, 60, 1)'
                        ],
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }

        function initializeCharts() {
            // Income Distribution Chart
            const incomeCtx = document.getElementById('incomeChart').getContext('2d');
            new Chart(incomeCtx, {
                type: 'bar',
                data: {
                    labels: ['‚Çπ0-‚Çπ5K', '‚Çπ5K-‚Çπ10K', '‚Çπ10K-‚Çπ20K', '‚Çπ20K-‚Çπ50K', '‚Çπ50K+'],
                    datasets: [{
                        label: 'Approval Rate (%)',
                        data: [25, 45, 68, 85, 92],
                        backgroundColor: [
                            'rgba(231, 76, 60, 0.8)',
                            'rgba(230, 126, 34, 0.8)',
                            'rgba(241, 196, 15, 0.8)',
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(39, 174, 96, 0.8)'
                        ],
                        borderColor: [
                            'rgba(231, 76, 60, 1)',
                            'rgba(230, 126, 34, 1)',
                            'rgba(241, 196, 15, 1)',
                            'rgba(46, 204, 113, 1)',
                            'rgba(39, 174, 96, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });

            // Credit Score Impact Chart
            const creditCtx = document.getElementById('creditChart').getContext('2d');
            new Chart(creditCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Approved (Good Credit)', 'Rejected (Poor Credit)'],
                    datasets: [{
                        data: [78, 22],
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(231, 76, 60, 0.8)'
                        ],
                        borderColor: [
                            'rgba(46, 204, 113, 1)',
                            'rgba(231, 76, 60, 1)'
                        ],
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }

        // Form submission handler
        document.getElementById('loanForm').addEventListener('submit', function(e) {
            // Add loading state
            const submitBtn = this.querySelector('.submit-btn');
            submitBtn.textContent = 'Processing...';
            submitBtn.disabled = true;
        });
    </script>
</body>
</html>
